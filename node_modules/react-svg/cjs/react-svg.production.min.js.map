{"version":3,"file":"react-svg.production.min.js","sources":["../src/shallow-differs.ts","../src/index.tsx"],"sourcesContent":["// Hat-tip: https://github.com/developit/preact-compat/blob/master/src/index.js#L402.\n\ninterface O {\n  [key: string]: any\n}\n\nconst shallowDiffers = (a: O, b: O) => {\n  for (const i in a) {\n    if (!(i in b)) {\n      return true\n    }\n  }\n\n  for (const i in b) {\n    if (a[i] !== b[i]) {\n      return true\n    }\n  }\n\n  return false\n}\n\nexport default shallowDiffers\n","import SVGInjector from '@tanem/svg-injector'\nimport * as PropTypes from 'prop-types'\nimport * as React from 'react'\nimport ReactDOMServer from 'react-dom/server'\nimport shallowDiffers from './shallow-differs'\n\nexport type OnInjected = (\n  error: Error | null,\n  svg: SVGSVGElement | undefined\n) => void\n\ninterface Props {\n  evalScripts?: 'always' | 'once' | 'never'\n  fallback?: React.ReactType\n  loading?: React.ReactType\n  onInjected?: OnInjected\n  renumerateIRIElements?: boolean\n  src: string\n  svgClassName?: string\n  svgStyle?: React.CSSProperties\n  wrapper?: 'div' | 'span'\n}\n\ninterface State {\n  hasError: boolean\n  isLoading: boolean\n}\n\nexport default class ReactSVG extends React.Component<\n  Props &\n    React.DetailedHTMLProps<\n      React.HTMLAttributes<HTMLSpanElement | HTMLDivElement>,\n      HTMLSpanElement | HTMLDivElement\n    >,\n  State\n> {\n  static defaultProps = {\n    evalScripts: 'never',\n    fallback: null,\n    loading: null,\n    onInjected: () => undefined,\n    renumerateIRIElements: true,\n    svgClassName: null,\n    svgStyle: {},\n    wrapper: 'div'\n  }\n\n  static propTypes = {\n    evalScripts: PropTypes.oneOf(['always', 'once', 'never']),\n    fallback: PropTypes.oneOfType([\n      PropTypes.func,\n      PropTypes.object,\n      PropTypes.string\n    ]),\n    loading: PropTypes.oneOfType([\n      PropTypes.func,\n      PropTypes.object,\n      PropTypes.string\n    ]),\n    onInjected: PropTypes.func,\n    renumerateIRIElements: PropTypes.bool,\n    src: PropTypes.string.isRequired,\n    svgClassName: PropTypes.string,\n    svgStyle: PropTypes.object,\n    wrapper: PropTypes.oneOf(['div', 'span'])\n  }\n\n  initialState = {\n    hasError: false,\n    isLoading: true\n  }\n\n  state = this.initialState\n\n  // tslint:disable-next-line:variable-name\n  _isMounted = false\n\n  container?: HTMLSpanElement | HTMLDivElement | null\n\n  svgWrapper?: HTMLSpanElement | HTMLDivElement | null\n\n  refCallback: React.Ref<HTMLSpanElement | HTMLDivElement> = container => {\n    this.container = container\n  }\n\n  renderSVG() {\n    if (this.container instanceof Node) {\n      const {\n        evalScripts,\n        renumerateIRIElements,\n        src,\n        svgClassName,\n        svgStyle\n      } = this.props\n      const onInjected = this.props.onInjected!\n      const Wrapper = this.props.wrapper!\n\n      const wrapper = document.createElement(Wrapper)\n      wrapper.innerHTML = ReactDOMServer.renderToStaticMarkup(\n        <Wrapper>\n          <Wrapper className={svgClassName} data-src={src} style={svgStyle} />\n        </Wrapper>\n      )\n\n      this.svgWrapper = this.container.appendChild(wrapper.firstChild as\n        | HTMLSpanElement\n        | HTMLDivElement)\n\n      const each: OnInjected = (error, svg) => {\n        if (error) {\n          this.removeSVG()\n        }\n\n        // TODO: It'd be better to cleanly unsubscribe from SVGInjector\n        // callbacks instead of tracking a property like this.\n        if (this._isMounted) {\n          this.setState(\n            () => ({\n              hasError: !!error,\n              isLoading: false\n            }),\n            () => {\n              onInjected(error, svg)\n            }\n          )\n        }\n      }\n\n      SVGInjector(this.svgWrapper.firstChild, {\n        each,\n        evalScripts,\n        renumerateIRIElements\n      })\n    }\n  }\n\n  removeSVG() {\n    if (this.container instanceof Node && this.svgWrapper instanceof Node) {\n      this.container.removeChild(this.svgWrapper)\n      this.svgWrapper = null\n    }\n  }\n\n  componentDidMount() {\n    this._isMounted = true\n    this.renderSVG()\n  }\n\n  componentDidUpdate(prevProps: Props) {\n    if (shallowDiffers(prevProps, this.props)) {\n      this.setState(\n        () => this.initialState,\n        () => {\n          this.removeSVG()\n          this.renderSVG()\n        }\n      )\n    }\n  }\n\n  componentWillUnmount() {\n    this._isMounted = false\n    this.removeSVG()\n  }\n\n  render() {\n    const {\n      evalScripts,\n      fallback: Fallback,\n      loading: Loading,\n      onInjected,\n      renumerateIRIElements,\n      src,\n      svgClassName,\n      svgStyle,\n      wrapper,\n      ...rest\n    } = this.props\n    const Wrapper = wrapper!\n\n    return (\n      <Wrapper {...rest} ref={this.refCallback}>\n        {this.state.isLoading && Loading && <Loading />}\n        {this.state.hasError && Fallback && <Fallback />}\n      </Wrapper>\n    )\n  }\n}\n"],"names":["shallowDiffers","a","b","i","ReactSVG","initialState","hasError","isLoading","state","_this","_isMounted","container","svgWrapper","refCallback","renderSVG","this","Node","props","evalScripts","renumerateIRIElements","src","svgClassName","svgStyle","onInjected","Wrapper","wrapper","document","createElement","innerHTML","ReactDOMServer","renderToStaticMarkup","React.createElement","className","style","appendChild","firstChild","SVGInjector","each","error","svg","_this2","removeSVG","setState","removeChild","componentDidMount","componentDidUpdate","prevProps","_this3","componentWillUnmount","render","Fallback","fallback","Loading","loading","rest","ref","React","defaultProps"],"mappings":"sfAMMA,eAAiB,SAACC,EAAMC,OACvB,IAAMC,KAAKF,OACRE,KAAKD,UACF,MAIN,IAAMC,KAAKD,KACVD,EAAEE,KAAOD,EAAEC,UACN,SAIJ,GCSYC,6JAuCnBC,aAAe,CACbC,UAAU,EACVC,WAAW,KAGbC,MAAQC,EAAKJ,eAGbK,YAAa,IAEbC,mBAEAC,oBAEAC,YAA2D,SAAAF,KACpDA,UAAYA,oDAGnBG,mCACMC,KAAKJ,qBAAqBK,KAAM,OAO9BD,KAAKE,MALPC,IAAAA,YACAC,IAAAA,sBACAC,IAAAA,IACAC,IAAAA,aACAC,IAAAA,SAEIC,EAAaR,KAAKE,MAAMM,WACxBC,EAAUT,KAAKE,MAAMQ,QAErBA,EAAUC,SAASC,cAAcH,GACvCC,EAAQG,UAAYC,eAAeC,qBACjCC,oBAACP,OACCO,oBAACP,GAAQQ,UAAWX,aAAwBD,EAAKa,MAAOX,WAIvDV,WAAaG,KAAKJ,UAAUuB,YAAYT,EAAQU,YAwBrDC,YAAYrB,KAAKH,WAAWuB,WAAY,CACtCE,KArBuB,SAACC,EAAOC,GAC3BD,GACFE,EAAKC,YAKHD,EAAK9B,YACP8B,EAAKE,SACH,iBAAO,CACLpC,WAAYgC,EACZ/B,WAAW,IAEb,WACEgB,EAAWe,EAAOC,MAQxBrB,YAAAA,EACAC,sBAAAA,QAKNsB,qBACM1B,KAAKJ,qBAAqBK,MAAQD,KAAKH,sBAAsBI,YAC1DL,UAAUgC,YAAY5B,KAAKH,iBAC3BA,WAAa,SAItBgC,kCACOlC,YAAa,OACbI,eAGP+B,4BAAmBC,cACb9C,eAAe8C,EAAW/B,KAAKE,aAC5ByB,SACH,kBAAMK,EAAK1C,cACX,WACE0C,EAAKN,YACLM,EAAKjC,iBAMbkC,qCACOtC,YAAa,OACb+B,eAGPQ,wBAYMlC,KAAKE,MATGiC,KADVhC,cACAiC,UACSC,IAATC,QAMA5B,KALAF,aACAJ,wBACAC,MACAC,eACAC,WACAG,SACG6B,uJAEC9B,EAAUC,SAGdM,oBAACP,cAAY8B,GAAMC,IAAKxC,KAAKF,cAC1BE,KAAKP,MAAMD,WAAa6C,GAAWrB,oBAACqB,QACpCrC,KAAKP,MAAMF,UAAY4C,GAAYnB,oBAACmB,aA3JPM,iBAAjBpD,SAQZqD,aAAe,CACpBvC,YAAa,QACbiC,SAAU,KACVE,QAAS,KACT9B,WAAY,aACZJ,uBAAuB,EACvBE,aAAc,KACdC,SAAU,GACVG,QAAS"}